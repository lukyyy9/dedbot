{% extends "base.html" %}

{% block content %}
<h1 style="margin-bottom: 20px;">üìä Dashboard</h1>

<div class="grid">
    <div class="card">
        <h2>‚öôÔ∏è Configuration actuelle</h2>
        <p><strong>P√©riode de donn√©es:</strong> {{ config.data_period }}</p>
        <p><strong>Timezone:</strong> {{ config.timezone }}</p>
        <p><strong>Tickers surveill√©s:</strong> {{ config.tickers|length }}</p>
        <p><strong>Webhook Discord:</strong> {{ '‚úÖ Configur√©' if config.webhook_url else '‚ùå Non configur√©' }}</p>
    </div>
    
    <div class="card">
        <h2>‚öñÔ∏è Formules et poids</h2>
        {% if formulas %}
            <p style="margin-bottom: 10px;">
                <strong>Total des poids:</strong> 
                <span style="color: {% if (total_weight - 1.0)|abs < 0.01 %}#3fb950{% else %}#f85149{% endif %}">
                    {{ total_weight|round(3) }}
                </span>
                {% if (total_weight - 1.0)|abs > 0.01 %}
                <span style="color: #f85149; font-size: 0.9em;">‚ö†Ô∏è Devrait √™tre 1.0</span>
                {% endif %}
            </p>
            <table style="font-size: 0.9em;">
                <thead>
                    <tr>
                        <th>Formule</th>
                        <th style="text-align: right;">Poids</th>
                        <th style="text-align: right;">Impact</th>
                    </tr>
                </thead>
                <tbody>
                    {% for name, data in formulas.items() %}
                    <tr>
                        <td><code>{{ name }}</code></td>
                        <td style="text-align: right;">{{ data.weight|round(3) }}</td>
                        <td style="text-align: right;">{{ (data.weight * 100)|round(1) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p style="color: #f85149;">‚ö†Ô∏è Aucune formule configur√©e</p>
            <p style="font-size: 0.9em; color: #8b949e;">
                Veuillez cr√©er des formules dans la page 
                <a href="{{ url_for('formulas_page') }}" style="color: #58a6ff;">Formules</a>
            </p>
        {% endif %}
    </div>
</div>

<div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-top: 20px;">
    <div class="stat">
        <div class="stat-value">{{ formulas|length }}</div>
        <div class="stat-label">Formules actives</div>
    </div>
    <div class="stat">
        <div class="stat-value">{{ config.tickers|length }}</div>
        <div class="stat-label">Tickers surveill√©s</div>
    </div>
    <div class="stat">
        <div class="stat-value" style="color: {% if (total_weight - 1.0)|abs < 0.01 %}#3fb950{% else %}#f85149{% endif %}">
            {{ total_weight|round(2) }}
        </div>
        <div class="stat-label">Total poids</div>
    </div>
</div>
{% endblock %}
